steps:
  - checkout: self
    fetchDepth: 2
    submodules: true
  - script: |
      git clone https://github.com/Microsoft/vcpkg
      cd vcpkg
      .\bootstrap-vcpkg.bat
      .\vcpkg install blaze:x64-windows
      .\vcpkg integrate install
      cd ..
    displayName: Install blaze using vcpkg
  - script: |
      md build
      cd build
      cmake .. -G "Visual Studio 15 2017 Win64" -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake
  - task: VSBuild@1
    inputs:
      solution: 'D:\a\1\s\build\CubbyDNN.sln'
      configuration: Release
      platform: x64
  - script: |
      D:\a\1\s\build\bin\Release\UnitTests.exe
